<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Crivit Rowing Monitor</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <!-- Hidden status for JS tracking -->
        <span id="connection-status" class="hidden">Disconnected</span>
        <span id="activity-status" class="hidden">Idle</span>

        <main>
            <!-- Tab Content: Row -->
            <div id="tab-row" class="tab-content active">
                <!-- Row 1: Power | Distance | HR -->
                <section class="metrics-grid row-3">
                    <div class="metric-card large">
                        <div class="metric-label">Power</div>
                        <div class="metric-value" id="power">0</div>
                        <div class="metric-unit">watts</div>
                    </div>
                    
                    <div class="metric-card large">
                        <div class="metric-label">Distance</div>
                        <div class="metric-value" id="distance">0</div>
                        <div class="metric-unit">meters</div>
                    </div>

                    <div class="metric-card large heart-rate" id="hr-card">
                        <div class="metric-label">‚ù§Ô∏è Heart Rate</div>
                        <div class="metric-value" id="heart-rate">--</div>
                        <div class="metric-unit" id="hr-status">bpm</div>
                    </div>
                </section>

                <!-- Row 2: Time | Pace /500m -->
                <section class="metrics-grid row-2">
                    <div class="metric-card large">
                        <div class="metric-label">Time</div>
                        <div class="metric-value" id="elapsed-time">0:00</div>
                        <div class="metric-unit">elapsed</div>
                    </div>

                    <div class="metric-card large highlight">
                        <div class="metric-label">Pace /500m</div>
                        <div class="metric-value" id="pace">--:--</div>
                        <div class="metric-unit">min:sec</div>
                    </div>
                </section>

                <!-- Row 3: Drag Factor | Stroke Rate | Strokes | Calories -->
                <section class="metrics-grid row-4">
                    <div class="metric-card">
                        <div class="metric-label">Drag Factor</div>
                        <div class="metric-value" id="drag-factor">--</div>
                        <div class="metric-unit">factor</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Stroke Rate</div>
                        <div class="metric-value" id="stroke-rate">0</div>
                        <div class="metric-unit">spm</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Strokes</div>
                        <div class="metric-value" id="stroke-count">0</div>
                        <div class="metric-unit">total</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Calories</div>
                        <div class="metric-value" id="calories">0</div>
                        <div class="metric-unit">kcal</div>
                    </div>
                </section>

                <!-- Row 4: Avg Power | Avg SPM | Avg HR | Avg Pace -->
                <section class="metrics-grid row-4 averages">
                    <div class="metric-card small">
                        <div class="metric-label">Avg Power</div>
                        <div class="metric-value" id="avg-power">0</div>
                    </div>

                    <div class="metric-card small">
                        <div class="metric-label">Avg SPM</div>
                        <div class="metric-value" id="avg-stroke-rate">0</div>
                    </div>

                    <div class="metric-card small">
                        <div class="metric-label">Avg HR</div>
                        <div class="metric-value" id="avg-heart-rate">--</div>
                    </div>

                    <div class="metric-card small">
                        <div class="metric-label">Avg Pace</div>
                        <div class="metric-value" id="avg-pace">--:--</div>
                    </div>
                </section>
            </div>

            <!-- Tab Content: Graph -->
            <div id="tab-chart" class="tab-content">
                <div class="chart-content">
                    <h2>üìä Live Graphs</h2>
                    
                    <div class="charts-grid">
                        <!-- Chart: Pace -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Pace /500m</span>
                                <span class="chart-value" id="chart-pace-value">--:--</span>
                            </div>
                            <canvas id="chart-pace" class="chart-canvas" aria-label="Pace over time chart"></canvas>
                        </div>
                        
                        <!-- Chart: Power -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Power</span>
                                <span class="chart-value" id="chart-power-value">0 W</span>
                            </div>
                            <canvas id="chart-power" class="chart-canvas" aria-label="Power over time chart"></canvas>
                        </div>
                        
                        <!-- Chart: Heart Rate -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Heart Rate</span>
                                <span class="chart-value" id="chart-hr-value">-- bpm</span>
                            </div>
                            <canvas id="chart-hr" class="chart-canvas" aria-label="Heart rate over time chart"></canvas>
                        </div>
                        
                        <!-- Chart: Strokes Per Minute -->
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Strokes/min</span>
                                <span class="chart-value" id="chart-spm-value">0 spm</span>
                            </div>
                            <canvas id="chart-spm" class="chart-canvas" aria-label="Strokes per minute over time chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Target Settings -->
                    <div class="chart-targets">
                        <h3>Targets (shown as dotted line)</h3>
                        <div class="targets-grid">
                            <div class="target-input">
                                <label for="target-pace">Pace (sec/500m)</label>
                                <input type="number" id="target-pace" min="60" max="300" step="1" placeholder="e.g. 120">
                            </div>
                            <div class="target-input">
                                <label for="target-power">Power (W)</label>
                                <input type="number" id="target-power" min="0" max="500" step="5" placeholder="e.g. 150">
                            </div>
                            <div class="target-input">
                                <label for="target-hr">Heart Rate (bpm)</label>
                                <input type="number" id="target-hr" min="60" max="220" step="1" placeholder="e.g. 140">
                            </div>
                            <div class="target-input">
                                <label for="target-spm">Strokes/min</label>
                                <input type="number" id="target-spm" min="10" max="50" step="1" placeholder="e.g. 24">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab Content: History -->
            <div id="tab-history" class="tab-content">
                <div class="history-content">
                    <h2>üìú Workout History</h2>
                    <div id="history-loading" class="history-loading">Loading workouts...</div>
                    <div id="history-empty" class="history-empty hidden">
                        <p>No saved workouts yet.</p>
                        <p>Complete a workout to see it here!</p>
                    </div>
                    <div id="history-list" class="history-list hidden"></div>
                </div>
            </div>

            <!-- Workout Charts Modal -->
            <div id="workout-detail-modal" class="modal hidden">
                <div class="modal-content workout-charts-modal">
                    <h2 id="detail-title">Workout Charts</h2>
                    <div class="modal-charts-grid">
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Pace /500m</span>
                            </div>
                            <canvas id="modal-chart-pace" class="chart-canvas" aria-label="Pace chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Power</span>
                            </div>
                            <canvas id="modal-chart-power" class="chart-canvas" aria-label="Power chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Heart Rate</span>
                            </div>
                            <canvas id="modal-chart-hr" class="chart-canvas" aria-label="Heart rate chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <div class="chart-header">
                                <span class="chart-title">Strokes/min</span>
                            </div>
                            <canvas id="modal-chart-spm" class="chart-canvas" aria-label="Strokes per minute chart"></canvas>
                        </div>
                    </div>
                    <p class="modal-note">Note: Detailed per-second data not yet stored. Charts will show averages.</p>
                    <div class="modal-actions">
                        <button id="btn-close-detail" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>

            <!-- Tab Content: Settings -->
            <div id="tab-settings" class="tab-content">
                <div class="settings-content">
                    <h2>‚öô Settings</h2>
                    <form id="settings-form">
                        <div class="form-group">
                            <label for="user-weight">Weight (kg)</label>
                            <input type="number" id="user-weight" min="30" max="200" step="0.5" value="75">
                        </div>
                        <div class="form-group">
                            <label for="units">Units</label>
                            <select id="units">
                                <option value="metric">Metric</option>
                                <option value="imperial">Imperial</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="show-power" checked> Show Power
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="show-calories" checked> Show Calories
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                            <span id="settings-feedback" class="settings-feedback"></span>
                        </div>
                    </form>
                    
                    <!-- Storage Counter -->
                    <div class="storage-info">
                        <h3>üì¶ Storage</h3>
                        <div class="storage-bar-container">
                            <div class="storage-bar" id="storage-bar"></div>
                        </div>
                        <div class="storage-text">
                            <span id="storage-used">0.0</span> / 30.0 hours saved
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation Bar -->
        <nav class="bottom-nav">
            <div class="nav-controls">
                <button id="btn-start-pause" class="btn btn-nav btn-start" aria-label="Start workout">‚ñ∂</button>
                <button id="btn-reset-workout" class="btn btn-nav btn-reset-workout" aria-label="Reset workout">‚Ü∫</button>
                <button id="btn-finish" class="btn btn-nav btn-finish" aria-label="Finish workout">‚úì</button>
            </div>
            <div class="nav-tabs">
                <button class="btn btn-tab active" data-tab="row">Row</button>
                <button class="btn btn-tab" data-tab="chart">Graph</button>
                <button class="btn btn-tab" data-tab="history">History</button>
                <button class="btn btn-tab" data-tab="settings">Settings</button>
            </div>
        </nav>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-content confirm-dialog">
            <h2 id="confirm-title">Confirm</h2>
            <p id="confirm-message">Are you sure?</p>
            <div class="modal-actions">
                <button id="btn-confirm-yes" class="btn btn-danger">Yes</button>
                <button id="btn-confirm-no" class="btn btn-secondary">No</button>
            </div>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>
